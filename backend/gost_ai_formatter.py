import openai

# Подставь свой ключ от DeepSeek
DEEPSEEK_API_KEY = "sk-15abeb7685c742478a7be0f4827c7cef"
MODEL = "deepseek-chat"
#MODEL = "deepseek-reasoner"
def format_gost(text: str) -> str:
    prompt = f"""
Ты — эксперт по оформлению библиографических ссылок строго по ГОСТ Р 7.0.5-2008 и ГОСТ Р 7.0.100-2018.

Задача:
Пользователь передаёт тебе текст библиографической ссылки. 
Ты должен выполнить следующее:

1. Анализировать ссылку и указать ВСЕ ошибки оформления по ГОСТ:
   - Отсутствие или неправильное указание автора (И.О., инициалы через точки)
   - Отсутствие или неправильное оформление названия источника
   - Отсутствие названия журнала, книги или сайта
   - Неправильное указание года, страниц, тома или номера журнала
   - Отсутствие или неверный ISSN/ISBN
   - Запрещённый источник (IEEE, Springer с 2024 года)

2. Если есть ошибки, подробно их перечислить.

3. Предложить абсолютно корректный, оформленный строго по ГОСТ вариант этой же ссылки.

4. Если источник зарубежный и запрещён (IEEE, Springer с 2024 года), явно это указать.

Выводи результат строго по шаблону:

ОШИБКИ:
- Ошибка 1 (описание)
- Ошибка 2
- ... (если ошибок нет, напиши "Ошибок нет")

ГОСТ:
Автор И.О. Название статьи // Название журнала. – Год. – Т. X. – № Y. – С. Z–Z. – ISSN XXXX-XXXX.

Если каких-то данных нет, явно укажи, что необходимо дополнить информацию.

Пример оформления (если ввод неверный или неполный):

Ввод:
"Петров 2020, стр. 15"

Вывод:
ОШИБКИ:
- Неполное имя автора (должно быть И.О.)
- Отсутствует название статьи
- Отсутствует название журнала
- Отсутствует номер выпуска или том

ГОСТ:
Петров И.И. Название статьи // Название журнала. – 2020. – Т. X. – № Y. – С. 15. – ISSN XXXX-XXXX.

Аналогично для всех ссылок, которые пользователь предоставит тебе.

Ссылка пользователя:
"{text}"
"""

    client = openai.OpenAI(api_key=DEEPSEEK_API_KEY, base_url="https://api.deepseek.com/v1")
    response = client.chat.completions.create(
        model="deepseek-reasoner",
        messages=[
            {"role": "user", "content": prompt}
        ],
        temperature=0.1,
        timeout=150
    )
    return response.choices[0].message.content.strip()

# Пример тестирования:
if __name__ == "__main__":
    test_cases = [
        "https://ieeexplore.ieee.org/document/1234567",
        "Смирнов 2023, статья про нейросети, журнал 'AI Today', стр. 45-48",
        "Петров И.С. Современные проблемы математики // Успехи математических наук. – 2022. – Т. 77. – №3. – С. 123–156.",
        "Неизвестный автор. Наука в XXI веке. URL: https://science21.com, дата обращения: 10.03.2025",
    ]

    for text in test_cases:
        result = format_gost(text)
        print(f"Исходный текст: {text}\nРезультат:\n{result}\n{'-'*60}")
